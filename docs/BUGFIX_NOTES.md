# Bug 修复笔记

## 问题 1: 回车键无法切换启用/禁用

### 原因
在 zsh 中，`read -rsk1` 读取回车时返回的可能是：
- 空字符串 `""`
- 换行符 `"\n"` (ASCII 10)
- 回车符 `"\r"` (ASCII 13)

**之前代码**：
```bash
case $input in
    "")  # 只匹配空字符串
        # 切换状态
        ;;
esac
```

**修复后**：
```bash
case "$input" in
    $'\r'|$'\n')  # 明确匹配回车符和换行符
        # 切换状态
        # 添加反馈信息
        # 等待用户确认
        ;;
esac
```

### 关键点
- 使用 `$'\r'` 匹配回车符 (ASCII 13)
- 使用 `$'\n'` 匹配换行符 (ASCII 10)
- 不依赖 `""` 空字符串匹配

## 问题 2: 默认铃声不正确

### 原因分析
经检查，代码逻辑是正确的：
- `HOOK_SOUND_INDEX` 初始化为 0（第一个铃声）
- 显示时用 `${sound_array[$((index + 1))]}`（zsh 数组从 1 开始）

### 验证
- Glass 是 macOS 第一个铃声（索引 0）
- 显示 "Glass (1/7)" 是正确的
- 左右键切换功能待实现

## 文件版本
- `install-claude-sounds-v2.sh` - 基础版（回车键问题）
- `install-claude-sounds-v3.sh` - 修复版（已修复回车键）

## 测试步骤
```bash
./install-claude-sounds-v3.sh
# 输入 y 然后回车
# 测试：
# 1. 方向键上下移动 ✓
# 2. 回车键切换启用/禁用 ✓
# 3. 查看默认铃声（Glass 1/7）✓
# 4. q 键退出 ✓
```
